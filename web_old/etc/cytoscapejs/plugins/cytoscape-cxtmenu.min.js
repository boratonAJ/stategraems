/*VERSION 1.0.2 APRIL2015*/(function(b){var c={menuRadius:100,selector:"node",commands:[],fillColor:"rgba(0, 0, 0, 0.75)",activeFillColor:"rgba(92, 194, 237, 0.75)",activePadding:20,indicatorSize:24,separatorWidth:3,spotlightPadding:4,minSpotlightRadius:24,maxSpotlightRadius:38,itemColor:"white",itemTextShadowColor:"black",zIndex:9999};var a=function(d,e){if(!d){return}d("core","cxtmenu",function(g){var E=e.extend(true,{},c,g);var F=g;var B=this;var n=e(B.container());var f;function z(r){var i=r.offset();i.left+=parseFloat(r.css("padding-left"));i.left+=parseFloat(r.css("border-left-width"));i.top+=parseFloat(r.css("padding-top"));i.top+=parseFloat(r.css("border-top-width"));return i}var X={options:E,handlers:[]};var s=e('<div class="cxtmenu"></div>');X.$container=s;var A=e("<div></div>");var w=e("<canvas></canvas>");var o=w[0].getContext("2d");var R=E.menuRadius;var k=(R+E.activePadding)*2;var I=undefined;var O;n.append(s);s.append(A);A.append(w);s.css({position:"absolute",zIndex:E.zIndex});A.css({width:k+"px",height:k+"px",position:"absolute",zIndex:1,marginLeft:-E.activePadding+"px",marginTop:-E.activePadding+"px"}).hide();w[0].width=k;w[0].height=k;var K=E.commands;var aa=2*Math.PI/(K.length);var u=K.length%2!==0?Math.PI/2:0;var t=u+aa;var Z=[];for(var W=0;W<K.length;W++){var x=K[W];var Q=(u+t)/2;var m=0.66*R*Math.cos(Q);var S=0.66*R*Math.sin(Q);var L=e('<div class="cxtmenu-item"></div>');L.css({color:E.itemColor,cursor:"default",display:"table","text-align":"center",position:"absolute","text-shadow":"-1px -1px "+E.itemTextShadowColor+", 1px -1px "+E.itemTextShadowColor+", -1px 1px "+E.itemTextShadowColor+", 1px 1px "+E.itemTextShadowColor,left:"50%",top:"50%","min-height":R*0.66,width:R*0.66,height:R*0.66,marginLeft:m-R*0.33,marginTop:-S-R*0.33});var j=e('<div class="cxtmenu-content">'+x.content+"</div>");j.css({width:R*0.66,height:R*0.66,"vertical-align":"middle",display:"table-cell"});A.append(L);L.append(j);u+=aa;t+=aa}var l,p;function v(){e(document).on("click",l=function(){A.hide()});s.on("click",p=function(){if(I!==undefined&&!!f){var i=E.commands[I].select;if(i){i.apply(f)}}})}function Y(){e(document).off("click",l);s.off("click",p)}function U(ag){ag=ag!==undefined?ag:G;o.globalCompositeOperation="source-over";o.clearRect(0,0,k,k);o.fillStyle=E.fillColor;o.beginPath();o.arc(R+E.activePadding,R+E.activePadding,R,0,Math.PI*2,true);o.closePath();o.fill();o.globalCompositeOperation="destination-out";o.strokeStyle="white";o.lineWidth=E.separatorWidth;var r=E.commands;var ah=2*Math.PI/(r.length);var ae=r.length%2!==0?Math.PI/2:0;var ad=ae+ah;for(var ac=0;ac<r.length;ac++){var ab=r[ac];var ai=R*Math.cos(ae);var af=R*Math.sin(ae);o.beginPath();o.moveTo(R+E.activePadding,R+E.activePadding);o.lineTo(R+E.activePadding+ai,R+E.activePadding-af);o.closePath();o.stroke();ae+=ah;ad+=ah}o.fillStyle="white";o.globalCompositeOperation="destination-out";o.beginPath();o.arc(R+E.activePadding,R+E.activePadding,ag+E.spotlightPadding,0,Math.PI*2,true);o.closePath();o.fill();o.globalCompositeOperation="source-over"}var q=0;var h=1000/30;var y;var D=true;function T(r){var ab=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var i=+new Date;clearTimeout(y);if(D||i>=q+h){ab(r);q=i;D=false}else{y=setTimeout(function(){ab(r);q=i},h*2)}}var N,M,G;var J;var V={on:function(r,i,ab){X.handlers.push({events:r,selector:i,fn:ab});if(i==="core"){B.on(r,function(ac){if(ac.cyTarget===B){return ab.apply(this,[ac])}})}else{B.on(r,i,ab)}return this}};function C(){var r;var ab=false;var i;V.on("cxttapstart taphold",E.selector,function(ah){f=this;var af=this;var ae=this===B;r=f.grabbable();if(r){f.ungrabify()}var ad,aj,ac;if(!ae&&af.isNode()){ad=af.renderedPosition();aj=af.renderedWidth();ac=af.renderedHeight()}else{ad=ah.cyRenderedPosition;aj=1;ac=1}var ai=e(window).scrollLeft();var ag=e(window).scrollTop();O=z(n);N=ad.x;M=ad.y;A.show().css({left:ad.x-R+"px",top:ad.y-R+"px"});G=Math.max(aj,ac)/2;G=Math.max(G,E.minSpotlightRadius);G=Math.min(G,E.maxSpotlightRadius);U();I=undefined;ab=true}).on("cxtdrag tapdrag",E.selector,i=function(ac){T(function(){if(!ab){return}var aq=ac.originalEvent.pageX-O.left-N;var ap=ac.originalEvent.pageY-O.top-M;if(aq===0){aq=0.01}var an=Math.sqrt(aq*aq+ap*ap);var am=(ap*ap-an*an-aq*aq)/(-2*an*aq);var af=Math.acos(am);I=undefined;if(an<G+E.spotlightPadding){U();return}U();var ae=aq*R/an;var ad=ap*R/an;if(ap>0){af=Math.PI+Math.abs(af-Math.PI)}var ag=E.commands;var ao=2*Math.PI/(ag.length);var al=ag.length%2!==0?Math.PI/2:0;var ak=al+ao;for(var aj=0;aj<ag.length;aj++){var ai=ag[aj];var ah=al<=af&&af<=ak||al<=af+2*Math.PI&&af+2*Math.PI<=ak;if(ah){o.fillStyle=E.activeFillColor;o.strokeStyle="black";o.lineWidth=1;o.beginPath();o.moveTo(R+E.activePadding,R+E.activePadding);o.arc(R+E.activePadding,R+E.activePadding,R+E.activePadding,2*Math.PI-al,2*Math.PI-ak,true);o.closePath();o.fill();I=aj;break}al+=ao;ak+=ao}o.fillStyle="white";o.globalCompositeOperation="destination-out";o.beginPath();o.translate(R+E.activePadding+ae/R*(G+E.spotlightPadding-E.indicatorSize/4),R+E.activePadding+ad/R*(G+E.spotlightPadding-E.indicatorSize/4));o.rotate(Math.PI/4-af);o.fillRect(-E.indicatorSize/2,-E.indicatorSize/2,E.indicatorSize,E.indicatorSize);o.closePath();o.fill();o.setTransform(1,0,0,1,0,0);o.beginPath();o.arc(R+E.activePadding,R+E.activePadding,G+E.spotlightPadding,0,Math.PI*2,true);o.closePath();o.fill();o.globalCompositeOperation="source-over"})}).on("tapdrag",i).on("cxttapend tapend",E.selector,function(ae){var ad=this;A.hide();if(I!==undefined){var ac=E.commands[I].select;if(ac){ac.apply(ad)}}ab=false;if(r){f.grabify()}}).on("cxttapend tapend",function(ac){A.hide();ab=false;if(r){f.grabify()}})}function P(){var r=X.handlers;for(var ab=0;ab<r.length;ab++){var ac=r[ab];if(ac.selector==="core"){B.off(ac.events,ac.fn)}else{B.off(ac.events,ac.selector,ac.fn)}}}function H(){P();Y();s.remove()}C();return{destroy:function(){H()}}})};if(typeof module!=="undefined"&&module.exports){module.exports=a}if(typeof define!=="undefined"&&define.amd){define("cytoscape-cxtmenu",function(){return a})}if(typeof cytoscape!=="undefined"){a(cytoscape,b)}})(jQuery);