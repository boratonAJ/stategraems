(function(b){var c={menuRadius:100,selector:"node",commands:[],fillColor:"rgba(0, 0, 0, 0.75)",activeFillColor:"rgba(92, 194, 237, 0.75)",activePadding:20,indicatorSize:24,separatorWidth:3,spotlightPadding:4,minSpotlightRadius:24,maxSpotlightRadius:38,itemColor:"white",itemTextShadowColor:"black",zIndex:999999};var a=function(d,e){if(!d){return}d("core","cxtmenu",function(g){var B=e.extend(true,{},c,g);var C=g;var y=this;var m=e(y.container());var f;function w(r){var i=r.offset();i.left+=parseFloat(r.css("padding-left"));i.left+=parseFloat(r.css("border-left-width"));i.top+=parseFloat(r.css("padding-top"));i.top+=parseFloat(r.css("border-top-width"));return i}var S={options:B,handlers:[]};var p=e('<div class="cxtmenu"></div>');S.$container=p;var x=e("<div></div>");var t=e("<canvas></canvas>");var n=t[0].getContext("2d");var M=B.menuRadius;var k=(M+B.activePadding)*2;var E=undefined;var J;m.append(p);p.append(x);x.append(t);p.css({position:"absolute",zIndex:B.zIndex});x.css({width:k+"px",height:k+"px",position:"absolute",zIndex:10000000,marginLeft:-B.activePadding+"px",marginTop:-B.activePadding+"px"}).hide();t[0].width=k;t[0].height=k;var G=B.commands;var U=2*Math.PI/(G.length);var s=G.length%2!==0?Math.PI/2:0;var q=s+U;var T=[];for(var R=0;R<G.length;R++){var u=G[R];var L=(s+q)/2;var l=0.66*M*Math.cos(L);var N=0.66*M*Math.sin(L);var H=e('<div class="cxtmenu-item"></div>');H.css({color:B.itemColor,cursor:"default",display:"table","text-align":"center",position:"absolute","text-shadow":"-1px -1px "+B.itemTextShadowColor+", 1px -1px "+B.itemTextShadowColor+", -1px 1px "+B.itemTextShadowColor+", 1px 1px "+B.itemTextShadowColor,left:"50%",top:"50%","min-height":M*0.66,width:M*0.66,height:M*0.66,marginLeft:l-M*0.33,marginTop:-N-M*0.33});var j=e('<div class="cxtmenu-content">'+u.content+"</div>");j.css({width:M*0.66,height:M*0.66,"vertical-align":"middle",display:"table-cell"});x.append(H);H.append(j);s+=U;q+=U}e(document).on("click",function(){x.hide()});p.on("click",function(){if(E!==undefined&&!!f){var i=B.commands[E].select;if(i){i.apply(f)}}});function P(aa){aa=aa!==undefined?aa:D;n.globalCompositeOperation="source-over";n.clearRect(0,0,k,k);n.fillStyle=B.fillColor;n.beginPath();n.arc(M+B.activePadding,M+B.activePadding,M,0,Math.PI*2,true);n.closePath();n.fill();n.globalCompositeOperation="destination-out";n.strokeStyle="white";n.lineWidth=B.separatorWidth;var r=B.commands;var ab=2*Math.PI/(r.length);var Y=r.length%2!==0?Math.PI/2:0;var X=Y+ab;for(var W=0;W<r.length;W++){var V=r[W];var ac=M*Math.cos(Y);var Z=M*Math.sin(Y);n.beginPath();n.moveTo(M+B.activePadding,M+B.activePadding);n.lineTo(M+B.activePadding+ac,M+B.activePadding-Z);n.closePath();n.stroke();Y+=ab;X+=ab}n.fillStyle="white";n.globalCompositeOperation="destination-out";n.beginPath();n.arc(M+B.activePadding,M+B.activePadding,aa+B.spotlightPadding,0,Math.PI*2,true);n.closePath();n.fill();n.globalCompositeOperation="source-over"}var o=0;var h=1000/30;var v;var A=true;function O(r){var V=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var i=+new Date;clearTimeout(v);if(A||i>=o+h){V(r);o=i;A=false}else{v=setTimeout(function(){V(r);o=i},h*2)}}var K,I,D;var F;var Q={on:function(r,i,V){S.handlers.push({events:r,selector:i,fn:V});y.on(r,i,V);return this}};function z(){Q.on("cxttapstart",B.selector,function(X){f=this;var V=this;var r,Z,i;if(V.isNode()){r=V.renderedPosition();Z=V.renderedWidth();i=V.renderedHeight()}else{r=X.cyRenderedPosition;Z=1;i=1}var Y=e(window).scrollLeft();var W=e(window).scrollTop();J=w(m);K=r.x;I=r.y;x.show().css({left:r.x-M+"px",top:r.y-M+"px"});D=Math.max(Z,i)/2;D=Math.max(D,B.minSpotlightRadius);D=Math.min(D,B.maxSpotlightRadius);P();E=undefined}).on("cxtdrag",B.selector,function(i){O(function(){var ah=i.originalEvent.pageX-J.left-K;var ag=i.originalEvent.pageY-J.top-I;if(ah===0){ah=0.01}var ae=Math.sqrt(ah*ah+ag*ag);var ad=(ag*ag-ae*ae-ah*ah)/(-2*ae*ah);var W=Math.acos(ad);E=undefined;if(ae<D+B.spotlightPadding){P();return}P();var V=ah*M/ae;var r=ag*M/ae;if(ag>0){W=Math.PI+Math.abs(W-Math.PI)}var X=B.commands;var af=2*Math.PI/(X.length);var ac=X.length%2!==0?Math.PI/2:0;var ab=ac+af;for(var aa=0;aa<X.length;aa++){var Z=X[aa];var Y=ac<=W&&W<=ab||ac<=W+2*Math.PI&&W+2*Math.PI<=ab;if(Y){n.fillStyle=B.activeFillColor;n.strokeStyle="black";n.lineWidth=1;n.beginPath();n.moveTo(M+B.activePadding,M+B.activePadding);n.arc(M+B.activePadding,M+B.activePadding,M+B.activePadding,2*Math.PI-ac,2*Math.PI-ab,true);n.closePath();n.fill();E=aa;break}ac+=af;ab+=af}n.fillStyle="white";n.globalCompositeOperation="destination-out";n.beginPath();n.translate(M+B.activePadding+V/M*(D+B.spotlightPadding-B.indicatorSize/4),M+B.activePadding+r/M*(D+B.spotlightPadding-B.indicatorSize/4));n.rotate(Math.PI/4-W);n.fillRect(-B.indicatorSize/2,-B.indicatorSize/2,B.indicatorSize,B.indicatorSize);n.closePath();n.fill();n.setTransform(1,0,0,1,0,0);n.beginPath();n.arc(M+B.activePadding,M+B.activePadding,D+B.spotlightPadding,0,Math.PI*2,true);n.closePath();n.fill();n.globalCompositeOperation="source-over"})}).on("cxttapend",B.selector,function(V){var r=this;x.hide();if(E!==undefined){var i=B.commands[E].select;if(i){i.apply(r)}}}).on("cxttapend",function(i){x.hide()})}z()})};if(typeof module!=="undefined"&&module.exports){module.exports=a}if(typeof define!=="undefined"&&define.amd){define("cytoscape-cxtmenu",function(){return a})}if(typeof cytoscape!=="undefined"){a(cytoscape,b)}})(jQuery);